#!/usr/bin/env node

/**
 * MEERA DUSKY - FOCUS 7 INNER THIGH STYLE
 * Based on meera_dusky_vspread_focus_07_1768336307501.png
 *
 * Maximum inner thigh prominence and detail
 * Generates 12 more in this successful style
 */

import Replicate from "replicate";
import fs from "node:fs";
import path from "node:path";

// Configuration
const OUTPUT_DIR = '/home/ecolex/version1/generated-meera-focus7-inner-thigh';
const MODEL = "imagineart/imagineart-1.0:b7178694f11dc428590f98d295a6e370bc3dc843819043d0f3621d66be13e440";
const NUM_IMAGES = 12;

// Ensure output directory exists
if (!fs.existsSync(OUTPUT_DIR)) {
  fs.mkdirSync(OUTPUT_DIR, { recursive: true });
}

// Initialize Replicate client
const replicate = new Replicate({
  auth: process.env.REPLICATE_API_TOKEN,
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FOCUS 7 INNER THIGH STYLE - MAXIMUM INNER THIGH DETAIL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const FOCUS7_INNER_THIGH_PROMPT = `[INNER THIGH FOCUSED INTIMATE PHOTOGRAPHY - MAXIMUM DETAIL]

[PRIMARY SUBJECT - INNER THIGH PROMINENCE]
THE PHOTOGRAPH IS ABOUT THE INNER THIGHS
Inner thighs are THE MAIN SUBJECT of this image
Soft, smooth inner thigh flesh filling significant portion of frame
V-shaped space between spread inner thighs as focal composition
Inner thigh skin texture rendered with hyper-realistic detail

[SUBJECT IDENTITY - LOCKED]
IDENTITY: Indian woman "Meera" | South Asian ethnicity | Age 27 | Height 5'9"

DUSKY INDIAN SKIN TONE:
â€¢ Deep warm dusky brown complexion - darker than typical "caramel"
â€¢ Rich coffee-with-milk undertones typical of South Indian women
â€¢ Warm bronze highlights where light catches inner thigh skin
â€¢ Natural dusky melanin richness - NOT pale, NOT fair, NOT light brown
â€¢ Authentic deeper Indian complexion with warm earthen undertones

INNER THIGH SKIN RENDERING (MAXIMUM DETAIL):
â€¢ Ultra-realistic skin texture on inner thighs
â€¢ Individual visible pores on inner thigh surfaces
â€¢ Natural micro-texture grain visible on inner thigh skin
â€¢ Subtle hair follicle texture even on smooth inner thigh areas
â€¢ Natural feminine softness and fullness of inner thighs
â€¢ Realistic skin folds where thighs meet torso
â€¢ Natural dusky brown to slightly lighter inner thigh gradation
â€¢ Soft flesh texture with natural weight and fullness
â€¢ Visible subtle veins under thin inner thigh skin
â€¢ Natural skin oil sheen catching light on inner thighs

LOCKED BODY (37DD-27-40):
â€¢ 37DD heavy natural bust - falling to sides when laying
â€¢ 27" dramatically cinched waist
â€¢ 40" wide round Indian hips framing spread thighs
â€¢ Full soft inner thighs with natural feminine fullness
â€¢ Natural weight distribution in relaxed pose

FACE (secondary, not primary focus):
â€¢ Dusky complexion matching body
â€¢ Deep dark brown almond-shaped eyes
â€¢ Full sensual lips with natural dusky rose tone
â€¢ Expression: Sensuous, relaxed

LOCKED ADORNMENTS:
â€¢ Platinum navel ring piercing catching light
â€¢ Delicate gold anklet on left ankle
â€¢ Diamond nose stud

[POSE - INNER THIGH MAXIMIZED]

POSITION:
â€¢ Laying on back, relaxed on surface
â€¢ Legs bent at knees and spread apart
â€¢ Inner thighs fully exposed and prominent
â€¢ The V-shape created by spread inner thighs is centered
â€¢ Soft inner thigh flesh visible from hip crease to knee

INNER THIGH DISPLAY:
â€¢ Both inner thighs equally visible in frame
â€¢ Maximum inner thigh skin surface shown
â€¢ Natural curves and feminine fullness emphasized
â€¢ Light catching the soft inner thigh surfaces
â€¢ The space between inner thighs as compositional center

BODY ARRANGEMENT:
â€¢ Torso relaxed, bust falling naturally
â€¢ Arms above head or relaxed at sides
â€¢ Hips settled, creating natural inner thigh spread
â€¢ Navel piercing visible catching light

[LIGHTING - INNER THIGH FOCUSED]

ILLUMINATION ON INNER THIGHS:
â€¢ Primary light falls on inner thigh surfaces
â€¢ Soft directional light highlighting inner thigh curves
â€¢ Bronze highlights on dusky inner thigh skin
â€¢ Gentle shadow in inner thigh creases and folds
â€¢ Light emphasizing the soft texture and fullness
â€¢ 70% shadow ratio with inner thighs prominently lit

DRAMATIC QUALITY:
â€¢ Low-key overall atmosphere
â€¢ Inner thighs emerge from shadow as brightest elements
â€¢ Chiaroscuro effect highlighting inner thigh contours
â€¢ Warm bronze tones on lit dusky skin

[ENVIRONMENT]
Setting: Black studio
Background: Deep black seamless
Surface: Dark fabric
Atmosphere: Intimate, dramatic

[TECHNICAL - INNER THIGH DETAIL CAPTURE]

CAMERA:
â€¢ Medium format quality
â€¢ 85mm equivalent for intimate inner thigh detail
â€¢ 8K resolution capturing inner thigh texture
â€¢ Shallow DOF with inner thighs tack-sharp

INNER THIGH DETAIL REQUIREMENTS:
â€¢ Visible pore structure on inner thigh skin
â€¢ Natural skin texture grain captured
â€¢ Realistic flesh quality and fullness
â€¢ Professional intimate photography standards
â€¢ Museum-quality skin detail rendering

COMPOSITION:
â€¢ Inner thighs as primary visual element (60%+ visual attention)
â€¢ V-spread composition centered
â€¢ Rule of thirds with inner thigh placement
â€¢ Intimate framing emphasizing inner thigh prominence

[VERIFICATION]
CONFIRM: Dusky Indian Meera (37DD-27-40)
CONFIRM: Inner thighs as PRIMARY SUBJECT
CONFIRM: Hyper-realistic inner thigh skin texture
CONFIRM: V-spread pose with inner thigh prominence
CONFIRM: Low-key dramatic lighting on inner thighs
CONFIRM: 8K professional quality
DO NOT CHANGE: Ethnicity, skin tone, measurements, inner thigh focus`;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DOWNLOAD & GENERATE FUNCTIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function downloadImage(url, filename) {
  const response = await fetch(url);
  const buffer = Buffer.from(await response.arrayBuffer());
  const filepath = path.join(OUTPUT_DIR, filename);
  fs.writeFileSync(filepath, buffer);
  const stats = fs.statSync(filepath);
  return (stats.size / 1024 / 1024).toFixed(2);
}

async function generateImage(num, total) {
  console.log(`â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•`);
  console.log(`[${new Date().toLocaleTimeString()}] ğŸ¦µ [${num}/${total}] Focus 7 Inner Thigh Style`);
  console.log(`[${new Date().toLocaleTimeString()}]    Muse: Dusky Indian Meera (37DD-27-40)`);
  console.log(`[${new Date().toLocaleTimeString()}]    Focus: INNER THIGH PRIMARY SUBJECT`);
  console.log(`[${new Date().toLocaleTimeString()}]    Style: Maximum Inner Thigh Detail`);

  try {
    console.log(`[${new Date().toLocaleTimeString()}]    ğŸ”„ Generating with ImagineArt 1.0...`);

    const input = {
      prompt: FOCUS7_INNER_THIGH_PROMPT,
      aspect_ratio: "3:4"
    };

    const output = await replicate.run(MODEL, { input });

    let imageUrl;
    if (typeof output === 'string') {
      imageUrl = output;
    } else if (output && typeof output.url === 'function') {
      imageUrl = output.url();
    } else if (output && output.url) {
      imageUrl = output.url;
    } else if (Array.isArray(output) && output.length > 0) {
      imageUrl = typeof output[0] === 'string' ? output[0] : output[0].url?.() || output[0].url;
    }

    if (imageUrl) {
      const filename = `meera_focus7_inner_thigh_${String(num).padStart(2, '0')}_${Date.now()}.png`;
      const size = await downloadImage(imageUrl, filename);

      console.log(`[${new Date().toLocaleTimeString()}]    âœ… SUCCESS: ${filename} (${size} MB)`);

      return {
        num,
        filename,
        size,
        success: true
      };
    } else {
      console.log(`[${new Date().toLocaleTimeString()}]    âŒ No output URL`);
      return { num, success: false, error: 'No output' };
    }
  } catch (error) {
    console.log(`[${new Date().toLocaleTimeString()}]    âŒ Error: ${error.message}`);
    return { num, success: false, error: error.message };
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MAIN EXECUTION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function main() {
  console.log(`
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                              â•‘
â•‘   ğŸ¦µ MEERA DUSKY - FOCUS 7 INNER THIGH STYLE ğŸ¦µ                             â•‘
â•‘                                                                              â•‘
â•‘   Based on: meera_dusky_vspread_focus_07 (1.53 MB)                          â•‘
â•‘                                                                              â•‘
â•‘   FOCUS: Inner Thigh as PRIMARY SUBJECT                                     â•‘
â•‘                                                                              â•‘
â•‘   LOCKED:                                                                   â•‘
â•‘   â€¢ Dusky Indian Meera (37DD-27-40)                                         â•‘
â•‘   â€¢ Inner Thigh Prominence & Detail                                         â•‘
â•‘   â€¢ V-Spread Pose                                                           â•‘
â•‘   â€¢ Low-Key Dramatic Lighting                                               â•‘
â•‘   â€¢ 8K Ultra-Realistic Quality                                              â•‘
â•‘                                                                              â•‘
â•‘   Generating ${NUM_IMAGES} Inner Thigh Focused Images                                 â•‘
â•‘                                                                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  `);

  if (!process.env.REPLICATE_API_TOKEN) {
    console.error('âŒ REPLICATE_API_TOKEN not set!');
    console.log('Set it with: export REPLICATE_API_TOKEN=r8_L30cnEji7Zl6Mb8pm5OYPDfxGPkOonw4Gw2PL');
    process.exit(1);
  }

  console.log(`[${new Date().toLocaleTimeString()}] âœ… Replicate API configured`);
  console.log(`[${new Date().toLocaleTimeString()}] ğŸ¦µ INNER THIGH PRIMARY FOCUS MODE`);
  console.log(`[${new Date().toLocaleTimeString()}] ğŸ¯ Model: ImagineArt 1.0`);
  console.log();

  const results = [];
  let successCount = 0;

  for (let i = 1; i <= NUM_IMAGES; i++) {
    const result = await generateImage(i, NUM_IMAGES);
    results.push(result);
    if (result.success) successCount++;

    if (i < NUM_IMAGES) {
      console.log(`[${new Date().toLocaleTimeString()}]    â³ Next in 10s...`);
      await new Promise(resolve => setTimeout(resolve, 10000));
    }
  }

  console.log(`
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘          ğŸ¦µ MEERA FOCUS 7 INNER THIGH COMPLETE ğŸ¦µ                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  âœ… Success: ${successCount}/${NUM_IMAGES}
  ğŸ“Š Rate: ${((successCount / NUM_IMAGES) * 100).toFixed(1)}%
  ğŸ“ Output: ${OUTPUT_DIR}
`);

  results.filter(r => r.success).forEach(r => {
    console.log(`     ğŸ¦µ Image ${r.num} (${r.size} MB)`);
  });

  if (results.some(r => !r.success)) {
    console.log(`\n  FAILED:`);
    results.filter(r => !r.success).forEach(r => {
      console.log(`     âŒ Image ${r.num} - ${r.error}`);
    });
  }

  fs.writeFileSync(
    path.join(OUTPUT_DIR, 'manifest.json'),
    JSON.stringify({
      collection: 'Meera Dusky - Focus 7 Inner Thigh Style',
      reference: 'meera_dusky_vspread_focus_07_1768336307501.png',
      model: 'imagineart/imagineart-1.0',
      focus: 'Inner thigh as primary subject with maximum detail',
      lockedElements: {
        subject: 'Dusky Indian Meera (37DD-27-40)',
        pose: 'V-Spread with Inner Thigh Prominence',
        lighting: 'Low-Key Dramatic (inner thighs lit)',
        environment: 'Black Studio'
      },
      generated: new Date().toISOString(),
      images: results,
      stats: { total: NUM_IMAGES, successful: successCount }
    }, null, 2)
  );
  console.log(`[${new Date().toLocaleTimeString()}] ğŸ“‹ Manifest saved`);
}

main().catch(console.error);
